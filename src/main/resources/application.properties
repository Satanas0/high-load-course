server.address=0.0.0.0
server.port=8081
server.http2.enabled=true
spring.main.allow-bean-definition-overriding=true

# Spring MVC async configuration
spring.mvc.async.request-timeout=200000

# Jetty thread pool optimization for 4000 RPS
server.jetty.threads.min=64
server.jetty.threads.max=512
server.jetty.threads.acceptors=16
server.jetty.threads.selectors=32
server.jetty.threads.max-queue-capacity=1000000
server.jetty.http2.max-concurrent-streams=${JETTY_HTTP2_MAX_STREAMS:10000}

# MongoDB properties
spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=online-shop

# Tiny event sourcing library properties
event.sourcing.auto-scan-enabled=true
event.sourcing.scan-package=ru.quipy
event.sourcing.snapshots-enabled=false
event.sourcing.sagas-enabled=false

# Postgres event store properties
spring.datasource.hikari.jdbc-url=jdbc:postgresql://${POSTGRES_ADDRESS:localhost}:${POSTGRES_PORT:65432}/postgres
spring.datasource.hikari.username=tiny_es
spring.datasource.hikari.password=tiny_es
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.maximum-pool-size=150
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.keepalive-time=60000

management.metrics.web.server.request.autotime.percentiles=0.95
management.metrics.export.prometheus.enabled=true
management.endpoints.web.exposure.include=info,health,prometheus,metrics

payment.service-name=${PAYMENT_SERVICE_NAME}
payment.token=${PAYMENT_TOKEN}
payment.accounts=${PAYMENT_ACCOUNTS:acc-13}
payment.hostPort=${PAYMENT_HOST:localhost}:${PAYMENT_PORT:1234}
payment.api.rate-limit-per-sec=${PAYMENT_API_RATE_LIMIT:4000}

metrics.incoming-requests.name=i_requests
metrics.incoming-requests.description=incoming requests
metrics.incoming-requests.tags=method,uri

metrics.outgoing-responses.name=o_responses
metrics.outgoing-responses.description=outgoing responses
metrics.outgoing-responses.tags=method,uri

metrics.completed-tasks.name=completed
metrics.completed-tasks.description=completed tasks
metrics.completed-tasks.tags=method

metrics.request-duration.name=request_duration
metrics.request-duration.description=Duration of request

metrics.retry-requests.name=retry_requests_1
metrics.retry-requests.description=Amount of retry requests
